# 实验室多端Web库存管理系统 - 产品需求文档（PRD）

## 1. 产品概述

### 1.1 产品愿景
为生物实验室提供一个灵活、易用的多端Web库存管理系统，支持自定义表格结构，实现库存的高效管理和查询，提升实验室库存管理的规范化和效率。

### 1.2 项目背景
当前生物实验室（主要研究免疫方向）的库存管理（如引物、质粒、试剂等）缺乏一个统一、灵活的系统，导致库存信息不清晰、管理效率低下。需要一个支持自定义表格结构的Web系统，以便根据实验室的实际需求灵活管理不同类型的库存信息。

### 1.3 目标用户
- **管理员**：实验室负责人或指定的系统管理员，负责系统的全面管理和配置
- **组长**：实验室小组负责人，负责小组内库存数据的管理
- **组员**：实验人员，负责库存数据的上传和查询

### 1.4 成功指标
- 系统上线时间：5天内完成开发和部署
- 用户满意度：实验室成员对系统的易用性和功能性给予积极反馈
- 系统稳定性：基本稳定运行，无严重故障
- 功能完整性：实现所有核心功能，满足用户基本需求

## 2. 用户需求分析

### 2.1 用户角色与权限

| 角色 | 权限描述 |
|------|----------|
| 管理员 | 1. 拥有所有系统权限<br>2. 定义和删除表格结构（列名、数据类型等）<br>3. 管理用户角色和权限（角色提权）<br>4. 执行所有数据操作（添加、修改、删除等）<br>5. 查看所有报表和统计信息 |
| 组长 | 1. 查看所有表格结构<br>2. 执行数据操作（添加、修改、删除）<br>3. 查看报表和统计信息<br>4. 不能删除表格类型 |
| 组员 | 1. 查看已定义的表格结构<br>2. 仅能上传/添加数据<br>3. 不能修改或删除数据<br>4. 查看库存数据 |

### 2.2 用户故事

| 用户角色 | 用户故事 |
|----------|----------|
| 管理员 | 作为管理员，我希望能够定义不同类型的库存表格结构，以便灵活管理各种类型的库存数据 |
| 管理员 | 作为管理员，我希望能够管理系统用户和权限，以便控制不同用户对系统的访问和操作权限 |
| 组长 | 作为组长，我希望能够添加、修改和删除库存数据，以便管理小组的库存信息 |
| 组员 | 作为组员，我希望能够上传新的库存数据，以便记录实验材料的入库信息 |
| 组员 | 作为组员，我希望能够查询库存数据，以便了解实验材料的库存情况 |
| 管理员/组长 | 作为管理员/组长，我希望能够查看库存统计报表，以便了解库存的使用情况和趋势 |

### 2.3 使用场景

#### 2.3.1 表格结构定义场景
- **场景描述**：管理员需要为实验室创建新的库存表格类型
- **使用流程**：管理员登录系统 → 进入表格定义页面 → 输入表格名称 → 添加列定义（列名、数据类型） → 保存表格结构

#### 2.3.2 库存数据管理场景
- **场景描述**：组长需要添加新的库存数据
- **使用流程**：组长登录系统 → 在侧边栏选择要操作的表格 → 点击"添加数据"按钮 → 填写数据表单 → 提交表单

#### 2.3.3 库存数据查询场景
- **场景描述**：组员需要查询特定的库存数据
- **使用流程**：组员登录系统 → 在侧边栏选择要查询的表格 → 系统加载并显示表格数据 → 用户可以使用筛选条件进行数据过滤

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 表格结构定义功能
- **功能描述**：允许管理员定义和管理库存表格的结构
- **详细需求**：
  - 支持定义总表名（需单独输入框）
  - 支持定义表格列信息，每列需包含：列名、数据类型（字符串类型）
  - 提供"添加列"功能（通过"+"按钮实现），允许用户添加多列以完成一张完整表格的定义
  - 提供表格定义的保存功能
  - 支持修改和删除已定义的表格结构（仅管理员）

#### 3.1.2 已定义表格管理功能
- **功能描述**：管理所有已定义的表格结构
- **详细需求**：
  - 在侧边栏显示所有已定义完成的表格名称列表
  - 支持点击表格名称触发操作，使数据显示区域加载并展示对应表格的数据
  - 支持表格名称的修改（仅管理员）
  - 支持表格结构的删除（仅管理员）

#### 3.1.3 库存数据管理功能
- **功能描述**：管理库存数据的增删改查
- **详细需求**：
  - 支持库存数据的入库、出库、调拨功能
  - 支持数据的添加（所有用户角色）
  - 支持数据的修改和删除（仅管理员和组长）
  - 支持按条件筛选和排序数据
  - 支持分页查询功能（默认每页10条记录）
  - 支持批量添加库存数据（仅管理员和组长）
  - 支持批量删除库存数据（仅管理员和组长）
  - 支持数据的导出功能（CSV格式），可导出指定表格的所有数据

#### 3.1.4 报表统计功能
- **功能描述**：提供库存统计和报表功能
- **详细需求**：
  - 支持查看一段时间内的库存消耗报表（可选择开始日期和结束日期）
  - 支持按不同维度（如时间、类型、人员等）生成报表
  - 报表以图表形式展示（柱状图）
  - 支持报表数据的导出功能
  - 支持按指定字段分组统计数据
  - 支持默认按日期分组统计数据
  - 返回统计数据和总记录数

### 3.2 辅助功能

#### 3.2.1 用户认证与授权功能
- **功能描述**：确保系统的安全访问
- **详细需求**：
  - 支持用户登录和注销功能
  - 支持不同用户角色的权限控制
  - 记录用户登录日志
  - 支持JWT认证机制，token有效期为24小时

#### 3.2.2 系统设置功能
- **功能描述**：提供系统级别的设置和配置
- **详细需求**：
  - 支持修改系统名称和基本信息
  - 支持备份和恢复数据
  - 支持清理系统日志

### 3.3 管理功能

#### 3.3.1 用户管理功能
- **功能描述**：管理系统用户和角色
- **详细需求**：
  - 支持添加、修改、删除用户（仅管理员）
  - 支持设置用户角色和权限（仅管理员）
  - 支持重置用户密码（仅管理员）

#### 3.3.2 操作日志功能
- **功能描述**：记录用户的操作日志
- **详细需求**：
  - 记录用户的登录、登出操作
  - 记录表格结构的创建、修改、删除操作
  - 记录库存数据的添加、修改、删除操作
  - 记录用户管理的相关操作

## 4. 非功能需求

### 4.1 性能需求
- 系统响应时间：页面加载时间不超过2秒，数据操作响应时间不超过1秒
- 并发用户数：支持同时10-20人在线使用
- 数据处理能力：能够处理至少10万条库存记录

### 4.2 安全需求
- 用户认证：支持用户名和密码登录认证
- 访问控制：基于角色的权限控制，确保用户只能访问和操作其权限范围内的功能
- 数据安全：数据库数据加密存储，防止未授权访问
- 日志记录：记录用户登录日志和关键操作日志
- 跨站请求伪造（CSRF）防护：确保系统不受CSRF攻击
- 跨站脚本（XSS）防护：确保系统不受XSS攻击

### 4.3 可用性需求
- 系统可用性：系统 uptime 不低于95%
- 故障恢复：系统故障后能够在30分钟内恢复正常运行
- 界面友好：操作流程简单直观，降低用户学习成本
- 错误处理：提供清晰的错误提示信息，帮助用户解决问题

### 4.4 兼容性需求
- 浏览器兼容：支持主流浏览器，包括Chrome、Firefox、Safari、Edge等
- 终端兼容：支持PC、平板、手机等不同终端设备，通过响应式设计适配不同屏幕尺寸
- 分辨率兼容：支持1024x768及以上分辨率
- 操作系统兼容：支持Windows、macOS、Linux等操作系统

## 5. 系统架构

### 5.1 技术栈

#### 5.1.1 前端技术栈
- React.js 18.2.0：构建用户界面
- Ant Design 5.12.0：UI组件库
- React Router DOM 6.21.0：路由管理
- Axios 1.6.0：HTTP请求
- Recharts 2.10.3：图表库
- Vite 5.0.8：构建工具

#### 5.1.2 后端技术栈
- Python 3.10+：后端开发语言
- Flask 3.1.2：Web框架
- Flask-SQLAlchemy 3.1.1：ORM框架
- Flask-CORS 6.0.1：跨域支持
- Werkzeug 3.1.4：密码加密和认证
- PyJWT 2.8.0：JWT认证
- python-dotenv 1.2.1：环境变量管理

#### 5.1.3 数据库
- SQLite：轻量级关系型数据库

### 5.2 系统结构

#### 5.2.1 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              客户端层                                      │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│    PC端浏览器   │    平板浏览器    │    手机浏览器    │    其他客户端   │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              前端层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  UI组件库       │  路由管理       │  状态管理       │  API请求封装    │
│  (Ant Design)   │  (React Router) │  (Context API)  │  (Axios)        │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              网络层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  HTTPS/HTTP     │  CORS跨域       │  数据压缩       │  缓存机制       │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              后端层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  API网关        │  认证授权       │  业务逻辑       │  数据访问层     │
│  (Flask)        │  (JWT)          │  (Python)       │  (SQLAlchemy)   │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  数据库         │  数据缓存       │  数据备份       │  日志管理       │
│  (SQLite)       │  (Memory)       │  (File)         │  (File/SQLite)  │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```

#### 5.2.2 前端架构分层

- **表现层**：负责用户界面的渲染和交互，使用React组件和Ant Design组件
- **路由层**：负责页面路由和导航，使用React Router
- **状态管理层**：管理应用状态，包括用户信息、表格数据、操作状态等，使用React Context API
- **服务层**：封装API请求，处理数据转换和错误处理，使用Axios

#### 5.2.3 后端架构分层

- **API层**：处理HTTP请求，路由分发，使用Flask路由
- **业务逻辑层**：实现业务逻辑，处理数据验证和转换
- **数据访问层**：处理数据库操作，包括查询、插入、更新、删除，使用SQLAlchemy ORM
- **工具层**：提供通用工具函数和服务

### 5.3 数据模型

#### 5.3.1 用户表（users）
| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | INTEGER | 用户ID，主键 |
| username | VARCHAR(50) | 用户名（唯一） |
| password | VARCHAR(255) | 密码（加密存储） |
| role | VARCHAR(20) | 用户角色（admin/leader/member） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 5.3.2 表格结构表（table_structures）
| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | INTEGER | 表格结构ID，主键 |
| table_name | VARCHAR(255) | 总表名 |
| columns | TEXT | 列定义（JSON字符串） |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 5.3.3 库存数据表（inventory_data）
| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | INTEGER | 数据ID，主键 |
| table_id | INTEGER | 所属表格ID，外键关联table_structures.id |
| data | TEXT | 库存数据（JSON字符串） |
| created_by | INTEGER | 创建者ID，外键关联users.id |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 5.3.4 操作日志表（operation_logs）
| 字段名 | 数据类型 | 描述 |
|--------|----------|------|
| id | INTEGER | 日志ID，主键 |
| user_id | INTEGER | 操作用户ID，外键关联users.id |
| operation | VARCHAR(255) | 操作描述 |
| table_id | INTEGER | 涉及的表格ID |
| data_id | INTEGER | 涉及的数据ID |
| created_at | DATETIME | 操作时间 |

## 6. 界面设计

### 6.1 设计原则
- **简洁性**：界面设计简洁明了，减少不必要的元素，突出核心功能
- **一致性**：保持界面元素的一致性，包括颜色、字体、按钮样式等
- **响应式**：采用响应式设计，适配不同终端设备的屏幕尺寸
- **易用性**：操作流程简单直观，降低用户学习成本

### 6.2 主要界面原型

#### 6.2.1 登录界面
- **功能描述**：用户登录系统的入口
- **界面元素**：
  - 系统标题
  - 用户名输入框
  - 密码输入框
  - 登录按钮

#### 6.2.2 主界面
- **功能描述**：系统的主要操作界面
- **界面元素**：
  - 顶部导航栏：系统标题、退出登录按钮
  - 左侧侧边栏：菜单导航（表格定义、已定义表格、数据管理、报表统计）
  - 右侧内容区域：根据选择的菜单显示对应的功能页面

#### 6.2.3 表格定义界面
- **功能描述**：定义和管理库存表格的结构
- **界面元素**：
  - 总表名输入框
  - 列定义区域：列名输入框、数据类型选择框、添加列按钮
  - 保存按钮

#### 6.2.4 数据管理界面
- **功能描述**：管理库存数据的增删改查
- **界面元素**：
  - 数据表格：显示库存数据
  - 操作按钮：添加数据、编辑数据、删除数据、导出数据
  - 筛选条件：按列筛选、排序功能

#### 6.2.5 报表统计界面
- **功能描述**：显示库存统计报表
- **界面元素**：
  - 报表图表：柱状图显示库存统计数据
  - 筛选条件：时间范围、数据维度选择
  - 导出按钮：导出报表数据

## 7. 实施计划

### 7.1 开发阶段

#### 7.1.1 需求分析与设计阶段（1天）
- 需求分析和确认
- 系统架构设计
- 数据库设计
- 界面原型设计

#### 7.1.2 后端开发阶段（2天）
- 搭建后端开发环境
- 实现用户认证和授权功能
- 实现表格结构管理功能
- 实现库存数据管理功能
- 实现报表统计功能
- 实现用户管理功能

#### 7.1.3 前端开发阶段（2天）
- 搭建前端开发环境
- 实现登录界面和主界面
- 实现表格定义界面
- 实现数据管理界面
- 实现报表统计界面
- 实现响应式设计

#### 7.1.4 测试与调试阶段（1天）
- 单元测试
- 集成测试
- 系统测试
- 性能测试
- 兼容性测试

### 7.2 测试计划

#### 7.2.1 测试目标
- 确保系统功能符合需求规格
- 确保系统性能满足要求
- 确保系统安全可靠
- 确保系统兼容不同的浏览器和终端设备

#### 7.2.2 测试内容
- 功能测试：验证系统的各项功能是否正常工作
- 性能测试：测试系统的响应时间、并发处理能力等
- 安全测试：测试系统的认证授权机制、数据加密等
- 兼容性测试：测试系统在不同浏览器和终端设备上的表现
- 用户体验测试：测试系统的易用性和界面设计

#### 7.2.3 测试方法
- 黑盒测试：不考虑内部实现，只测试系统的功能和性能
- 白盒测试：考虑内部实现，测试系统的代码质量和逻辑
- 自动化测试：使用自动化测试工具进行测试
- 手动测试：由测试人员手动测试系统的功能和性能

### 7.3 上线计划

#### 7.3.1 上线前准备
- 系统部署到生产环境
- 数据迁移（如果有）
- 系统配置和优化
- 上线前的最终测试

#### 7.3.2 上线流程
- 发布系统到生产环境
- 监控系统运行状态
- 收集用户反馈
- 及时处理系统问题和bug

#### 7.3.3 上线后维护
- 系统性能监控和优化
- 定期备份数据
- 定期更新系统版本
- 处理用户反馈和需求变更

## 8. 风险评估

### 8.1 技术风险

#### 8.1.1 数据库性能风险
- **风险描述**：随着数据量的增加，SQLite数据库可能会出现性能问题
- **风险级别**：中
- **应对策略**：
  - 优化数据库查询语句
  - 考虑在未来版本中迁移到更强大的数据库（如MySQL、PostgreSQL）
  - 实施数据分页和缓存机制

#### 8.1.2 安全性风险
- **风险描述**：系统可能存在安全漏洞，如SQL注入、XSS攻击等
- **风险级别**：高
- **应对策略**：
  - 实施严格的输入验证和输出编码
  - 使用参数化查询防止SQL注入
  - 实施JWT认证和权限控制
  - 定期进行安全审计和漏洞扫描

### 8.2 业务风险

#### 8.2.1 用户接受度风险
- **风险描述**：用户可能不接受新系统，或者学习成本过高
- **风险级别**：中
- **应对策略**：
  - 提供详细的用户手册和培训
  - 设计简洁易用的界面
  - 收集用户反馈并及时改进

#### 8.2.2 需求变更风险
- **风险描述**：用户需求可能会在开发过程中发生变更
- **风险级别**：中
- **应对策略**：
  - 建立完善的需求变更管理流程
  - 定期与用户沟通，确认需求
  - 采用敏捷开发方法，灵活应对需求变更

### 8.3 应对策略

#### 8.3.1 技术风险应对策略
- 建立完善的监控和告警机制
- 定期进行系统性能测试和优化
- 采用安全编码规范，定期进行安全审计

#### 8.3.2 业务风险应对策略
- 与用户保持密切沟通，及时了解用户需求
- 提供良好的用户培训和支持
- 建立完善的需求变更管理流程

## 9. 附录

### 9.1 术语表

| 术语 | 解释 |
|------|------|
| JWT | JSON Web Token，一种用于身份验证的令牌格式 |
| ORM | Object-Relational Mapping，对象关系映射，用于将数据库操作转换为对象操作 |
| API | Application Programming Interface，应用程序编程接口 |
| CORS | Cross-Origin Resource Sharing，跨域资源共享，用于解决跨域请求问题 |
| SQLite | 一种轻量级关系型数据库 |
| React | 一种用于构建用户界面的JavaScript库 |
| Flask | 一种轻量级的Python Web框架 |

### 9.2 参考文档

- 《Flask官方文档》
- 《React官方文档》
- 《SQLAlchemy官方文档》
- 《Ant Design官方文档》
- 《JWT认证机制详解》
- 《RESTful API设计指南》