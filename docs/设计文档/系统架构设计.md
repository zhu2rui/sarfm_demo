# 实验室多端Web库存管理系统 - 系统架构设计

## 1. 系统架构概述

### 1.1 架构设计原则

1. **模块化设计**：系统采用模块化设计，将功能划分为独立的模块，便于开发、测试和维护
2. **前后端分离**：采用前后端分离架构，前端负责用户界面和交互，后端负责业务逻辑和数据处理
3. **响应式设计**：前端采用响应式设计，适配不同终端设备
4. **安全性优先**：系统设计考虑安全性，包括用户认证、权限控制、数据加密等
5. **可扩展性**：系统架构支持功能扩展和性能扩展
6. **可靠性**：系统设计考虑容错和恢复机制，确保系统稳定运行

### 1.2 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              客户端层                                      │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│    PC端浏览器   │    平板浏览器    │    手机浏览器    │    其他客户端   │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              前端层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  UI组件库       │  路由管理       │  状态管理       │  API请求封装    │
│  (Ant Design)   │  (React Router) │  (Context API)  │  (Axios)        │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              网络层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  HTTPS/HTTP     │  CORS跨域       │  数据压缩       │  缓存机制       │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              后端层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  API网关        │  认证授权       │  业务逻辑       │  数据访问层     │
│  (Flask)        │  (JWT)          │  (Python)       │  (SQLAlchemy)   │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据层                                        │
├─────────────────┬─────────────────┬─────────────────┬─────────────────┤
│  数据库         │  数据缓存       │  数据备份       │  日志管理       │
│  (SQLite)       │  (Memory)       │  (File)         │  (File/SQLite)  │
└─────────────────┴─────────────────┴─────────────────┴─────────────────┘
```

## 2. 前端架构设计

### 2.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React.js | ^18.2.0 | 构建用户界面 |
| Ant Design | ^5.12.0 | UI组件库 |
| React Router | ^6.21.0 | 路由管理 |
| Axios | ^1.6.0 | HTTP请求 |
| Vite | ^5.0.8 | 构建工具 |

### 2.2 前端架构分层

#### 2.2.1 表现层

- **职责**：负责用户界面的渲染和交互
- **技术实现**：React组件、Ant Design组件
- **核心组件**：
  - 登录组件
  - 主布局组件
  - 表格定义组件
  - 数据管理组件
  - 报表统计组件

#### 2.2.2 路由层

- **职责**：负责页面路由和导航
- **技术实现**：React Router
- **核心配置**：
  - 登录路由
  - 主界面路由
  - 表格定义路由
  - 数据管理路由
  - 报表统计路由

#### 2.2.3 状态管理层

- **职责**：管理应用状态，包括用户信息、表格数据、操作状态等
- **技术实现**：React Context API
- **核心状态**：
  - 用户状态
  - 表格结构状态
  - 库存数据状态
  - 操作日志状态

#### 2.2.4 服务层

- **职责**：封装API请求，处理数据转换和错误处理
- **技术实现**：Axios
- **核心服务**：
  - 用户认证服务
  - 表格结构管理服务
  - 库存数据管理服务
  - 报表统计服务

### 2.3 前端组件结构

```
├── src/
│   ├── components/          # 通用组件
│   │   ├── Header/         # 标题组件
│   │   ├── Sidebar/        # 侧边栏组件
│   │   ├── TableDefinition/ # 表格定义组件
│   │   ├── TableList/      # 表格列表组件
│   │   ├── DataTable/      # 数据表格组件
│   │   └── Report/         # 报表组件
│   ├── pages/              # 页面组件
│   │   ├── Login/          # 登录页面
│   │   ├── Main/           # 主页面
│   │   ├── TableDefinitionPage/ # 表格定义页面
│   │   ├── DataManagementPage/  # 数据管理页面
│   │   └── ReportPage/     # 报表页面
│   ├── services/           # API服务
│   │   ├── authService.js  # 认证服务
│   │   ├── tableService.js # 表格服务
│   │   ├── dataService.js  # 数据服务
│   │   └── reportService.js # 报表服务
│   ├── context/            # 状态管理
│   │   └── AppContext.js   # 应用状态
│   ├── router/             # 路由配置
│   │   └── index.js        # 路由定义
│   ├── utils/              # 工具函数
│   │   ├── request.js      # 请求封装
│   │   └── helpers.js       # 辅助函数
│   ├── App.jsx             # 根组件
│   ├── main.jsx            # 入口文件
│   └── index.css           # 全局样式
```

### 2.4 前端数据流

1. **用户交互**：用户在界面上进行操作，触发组件事件
2. **状态更新**：组件事件调用状态管理API，更新应用状态
3. **API请求**：状态更新触发API请求，调用后端服务
4. **数据响应**：后端返回数据，更新应用状态
5. **界面更新**：应用状态更新触发组件重新渲染，更新界面

## 3. 后端架构设计

### 3.1 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Python | 3.10+ | 后端开发语言 |
| Flask | ^3.1.2 | Web框架 |
| Flask-SQLAlchemy | ^3.1.1 | ORM框架 |
| Flask-CORS | ^6.0.1 | 跨域支持 |
| Werkzeug | ^3.1.4 | 密码加密和认证 |
| python-dotenv | ^1.2.1 | 环境变量管理 |

### 3.2 后端架构分层

#### 3.2.1 API层

- **职责**：处理HTTP请求，路由分发
- **技术实现**：Flask路由
- **核心API**：
  - 用户认证API
  - 表格结构管理API
  - 库存数据管理API
  - 报表统计API
  - 日志管理API

#### 3.2.2 业务逻辑层

- **职责**：实现业务逻辑，处理数据验证和转换
- **技术实现**：Python类和函数
- **核心服务**：
  - 用户认证服务
  - 权限管理服务
  - 表格结构管理服务
  - 库存数据管理服务
  - 报表统计服务

#### 3.2.3 数据访问层

- **职责**：处理数据库操作，包括查询、插入、更新、删除
- **技术实现**：SQLAlchemy ORM
- **核心模型**：
  - User模型
  - TableStructure模型
  - InventoryData模型
  - OperationLog模型

#### 3.2.4 工具层

- **职责**：提供通用工具函数，包括日志、加密、验证等
- **技术实现**：Python模块
- **核心工具**：
  - 日志工具
  - 加密工具
  - 验证工具
  - 响应工具

### 3.3 后端目录结构

```
├── backend/
│   ├── app/
│   │   ├── __init__.py      # 应用初始化
│   │   ├── config.py        # 配置文件
│   │   ├── models/          # 数据模型
│   │   │   ├── __init__.py
│   │   │   ├── user.py      # 用户模型
│   │   │   ├── table.py     # 表格结构模型
│   │   │   ├── data.py      # 库存数据模型
│   │   │   └── log.py       # 日志模型
│   │   ├── routes/          # 路由定义
│   │   │   ├── __init__.py
│   │   │   ├── auth.py      # 认证路由
│   │   │   ├── table.py     # 表格结构路由
│   │   │   ├── data.py      # 库存数据路由
│   │   │   ├── report.py    # 报表路由
│   │   │   └── log.py       # 日志路由
│   │   ├── services/        # 业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── auth_service.py   # 认证服务
│   │   │   ├── table_service.py  # 表格结构服务
│   │   │   ├── data_service.py   # 库存数据服务
│   │   │   ├── report_service.py # 报表服务
│   │   │   └── log_service.py    # 日志服务
│   │   ├── utils/           # 工具函数
│   │   │   ├── __init__.py
│   │   │   ├── auth.py      # 认证工具
│   │   │   ├── response.py   # 响应工具
│   │   │   └── log.py       # 日志工具
│   │   └── middleware/      # 中间件
│   │       ├── __init__.py
│   │       ├── auth.py      # 认证中间件
│   │       └── cors.py      # CORS中间件
│   ├── instance/            # 实例配置
│   │   └── inventory.db     # SQLite数据库文件
│   ├── requirements.txt     # 依赖包
│   ├── .env                 # 环境变量
│   └── app.py               # 应用入口
```

### 3.4 后端数据流

1. **HTTP请求**：前端发送HTTP请求到后端
2. **路由分发**：Flask路由将请求分发到对应的视图函数
3. **中间件处理**：中间件进行认证、权限检查等处理
4. **业务逻辑**：视图函数调用业务逻辑服务，处理业务规则
5. **数据操作**：业务逻辑服务调用数据访问层，进行数据库操作
6. **响应返回**：处理结果通过HTTP响应返回给前端

## 4. 数据库设计

### 4.1 数据库选型

- **数据库类型**：SQLite
- **选择理由**：
  - 轻量级，无需独立服务器
  - 易于部署和维护
  - 支持标准SQL语法
  - 适合小型应用和原型开发
  - 内置事务支持

### 4.2 数据库表结构

#### 4.2.1 用户表（users）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | 用户ID |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密存储） |
| role | VARCHAR(20) | NOT NULL | 用户角色（admin/leader/member） |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.2 表格结构表（table_structures）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | 表格结构ID |
| table_name | VARCHAR(255) | NOT NULL | 总表名 |
| columns | TEXT | NOT NULL | 列定义JSON字符串 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.3 库存数据表（inventory_data）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | 数据ID |
| table_id | INTEGER | FOREIGN KEY REFERENCES table_structures(id) | 所属表格ID |
| data | TEXT | NOT NULL | 库存数据JSON字符串 |
| created_by | INTEGER | FOREIGN KEY REFERENCES users(id) | 创建者ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 4.2.4 操作日志表（operation_logs）

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | 日志ID |
| user_id | INTEGER | FOREIGN KEY REFERENCES users(id) | 操作用户ID |
| operation | VARCHAR(255) | NOT NULL | 操作描述 |
| table_id | INTEGER | NULL | 涉及的表格ID |
| data_id | INTEGER | NULL | 涉及的数据ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 操作时间 |

### 4.3 数据库关系图

```
┌─────────────┐       ┌─────────────────┐       ┌─────────────────┐
│   Users     │       │ TableStructures │       │ InventoryData   │
├─────────────┤       ├─────────────────┤       ├─────────────────┤
│ id          │<──────┤ id              │<──────┤ id              │
│ username    │       │ table_name      │       │ table_id        │
│ password    │       │ columns         │       │ data            │
│ role        │       │ created_at      │       │ created_by      │
│ created_at  │       │ updated_at      │       │ created_at      │
│ updated_at  │       └─────────────────┘       │ updated_at      │
└─────────────┘                                 └─────────────────┘
        │                                               ▲
        │                                               │
        ▼                                               │
┌───────────────┐                                       │
│ OperationLogs │───────────────────────────────────────┘
├───────────────┤
│ id            │
│ user_id       │
│ operation     │
│ table_id      │
│ data_id       │
│ created_at    │
└───────────────┘
```

## 5. API设计

### 5.1 API设计原则

1. **RESTful设计**：API遵循RESTful设计规范，使用HTTP方法和状态码
2. **统一接口**：API接口格式统一，便于前端调用
3. **安全性**：API设计考虑安全性，包括认证、授权、数据加密等
4. **版本控制**：API支持版本控制，便于后续扩展
5. **错误处理**：API提供清晰的错误信息，便于调试和使用

### 5.2 API版本控制

- **版本号**：v1
- **URL前缀**：/api/v1

### 5.3 API路由设计

#### 5.3.1 认证API

| URL | 方法 | 功能 | 权限 |
|-----|------|------|------|
| /api/v1/auth/login | POST | 用户登录 | 公开 |
| /api/v1/auth/logout | POST | 用户登出 | 登录用户 |
| /api/v1/auth/me | GET | 获取当前用户信息 | 登录用户 |

#### 5.3.2 表格结构API

| URL | 方法 | 功能 | 权限 |
|-----|------|------|------|
| /api/v1/tables | GET | 获取表格列表 | 登录用户 |
| /api/v1/tables | POST | 创建表格 | 管理员 |
| /api/v1/tables/:id | GET | 获取表格详情 | 登录用户 |
| /api/v1/tables/:id | PUT | 更新表格 | 管理员 |
| /api/v1/tables/:id | DELETE | 删除表格 | 管理员 |

#### 5.3.3 库存数据API

| URL | 方法 | 功能 | 权限 |
|-----|------|------|------|
| /api/v1/tables/:table_id/data | GET | 获取表格数据 | 登录用户 |
| /api/v1/tables/:table_id/data | POST | 添加数据 | 登录用户 |
| /api/v1/data/:id | GET | 获取数据详情 | 登录用户 |
| /api/v1/data/:id | PUT | 更新数据 | 管理员/组长/创建者 |
| /api/v1/data/:id | DELETE | 删除数据 | 管理员/组长/创建者 |
| /api/v1/tables/:table_id/data/batch | POST | 批量添加数据 | 管理员/组长 |
| /api/v1/data/batch | DELETE | 批量删除数据 | 管理员/组长 |

#### 5.3.4 报表统计API

| URL | 方法 | 功能 | 权限 |
|-----|------|------|------|
| /api/v1/reports/:table_id | GET | 生成报表 | 登录用户 |
| /api/v1/reports/:table_id/export | GET | 导出报表 | 登录用户 |
| /api/v1/reports/stats/:table_id | GET | 获取数据统计 | 登录用户 |

#### 5.3.5 日志API

| URL | 方法 | 功能 | 权限 |
|-----|------|------|------|
| /api/v1/logs | GET | 获取操作日志 | 管理员 |
| /api/v1/logs/:id | GET | 获取日志详情 | 管理员 |

### 5.4 API请求和响应格式

#### 5.4.1 请求格式

```json
{
  "field1": "value1",
  "field2": "value2",
  "field3": "value3"
}
```

#### 5.4.2 响应格式

1. **成功响应**：
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "key1": "value1",
    "key2": "value2"
  }
}
```

2. **分页响应**：
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "list": [
      { "id": 1, "name": "item1" },
      { "id": 2, "name": "item2" }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

3. **错误响应**：
```json
{
  "code": 400,
  "message": "Error message",
  "data": null
}
```

## 6. 安全架构设计

### 6.1 认证与授权

1. **认证方式**：基于JWT的认证
2. **授权方式**：基于角色的权限控制（RBAC）
3. **权限级别**：
   - 管理员：所有权限
   - 组长：数据管理和报表查看权限
   - 组员：数据查看和添加权限

### 6.2 数据安全

1. **密码加密**：使用bcrypt算法加密存储密码
2. **数据传输**：使用HTTPS协议传输数据
3. **SQL注入防护**：使用ORM框架，防止SQL注入攻击
4. **XSS防护**：前端使用React的JSX转义，防止XSS攻击
5. **CSRF防护**：实现CSRF令牌机制

### 6.3 操作审计

1. **操作日志**：记录所有关键操作，包括用户登录、数据修改、表格创建等
2. **日志内容**：包含操作用户、操作时间、操作类型、涉及资源等信息
3. **日志存储**：操作日志存储在数据库中，便于查询和审计

## 7. 部署架构设计

### 7.1 部署环境

| 环境 | 配置 | 用途 |
|------|------|------|
| 开发环境 | 开发人员本地环境 | 开发和测试 |
| 测试环境 | 与生产环境相似 | 集成测试和验收测试 |
| 生产环境 | 正式运行环境 | 系统部署和运行 |

### 7.2 部署方案

1. **后端部署**：
   - 使用Flask内置服务器（开发环境）
   - 使用Gunicorn + Nginx（生产环境）

2. **前端部署**：
   - 使用Vite开发服务器（开发环境）
   - 构建静态文件，使用Nginx或CDN（生产环境）

3. **数据库部署**：
   - SQLite文件存储（所有环境）
   - 定期备份数据库文件

4. **环境配置**：
   - 使用环境变量管理配置
   - 不同环境使用不同的配置文件

### 7.3 高可用性设计

1. **备份策略**：
   - 定期备份数据库文件
   - 备份文件存储在不同位置

2. **监控策略**：
   - 监控系统运行状态
   - 监控API请求和响应时间
   - 监控数据库性能

3. **恢复策略**：
   - 制定灾难恢复计划
   - 定期测试恢复流程

## 8. 性能优化设计

### 8.1 前端性能优化

1. **代码分割**：使用React.lazy和Suspense进行代码分割
2. **懒加载**：图片和组件懒加载
3. **虚拟滚动**：大数据表格使用虚拟滚动
4. **缓存机制**：API请求结果缓存
5. **减少重渲染**：使用React.memo和useMemo优化组件渲染

### 8.2 后端性能优化

1. **数据库优化**：
   - 添加索引，提高查询速度
   - 优化SQL查询，减少数据库负载
   - 使用连接池，提高数据库连接效率

2. **缓存机制**：
   - 缓存频繁访问的数据
   - 使用Redis或内存缓存

3. **异步处理**：
   - 异步处理耗时操作
   - 使用消息队列处理后台任务

4. **代码优化**：
   - 优化算法和数据结构
   - 减少不必要的计算和IO操作

## 9. 扩展设计

### 9.1 功能扩展

1. **模块化设计**：系统采用模块化设计，便于添加新功能
2. **插件机制**：支持插件扩展，便于功能扩展
3. **API设计**：API设计考虑扩展性，便于添加新的API端点

### 9.2 性能扩展

1. **水平扩展**：支持多实例部署，提高系统容量
2. **负载均衡**：使用负载均衡器分发请求
3. **数据库扩展**：支持数据库分片和读写分离

### 9.3 技术栈扩展

1. **数据库扩展**：支持从SQLite迁移到MySQL或PostgreSQL
2. **前端框架扩展**：支持React组件库扩展
3. **后端框架扩展**：支持Flask扩展，便于添加新功能

## 10. 总结

本系统采用前后端分离架构，前端使用React.js和Ant Design，后端使用Python和Flask，数据库使用SQLite。系统设计遵循模块化、安全性、可扩展性等原则，能够满足实验室多端Web库存管理的需求。

系统架构设计考虑了性能优化、安全设计、部署架构和扩展设计，能够支持系统的长期发展和演进。通过合理的架构设计，系统能够实现自定义表格结构、库存数据管理、报表统计等核心功能，同时确保系统的稳定性、安全性和可用性。