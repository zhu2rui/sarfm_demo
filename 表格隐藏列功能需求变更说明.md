# 实验室多端Web库存管理系统 - 表格隐藏列功能需求变更说明

## 1. 变更概述

### 1.1 变更类型
功能增强 - 新增表格隐藏列功能

### 1.2 变更背景
当前系统的数据管理页面中，所有表格列均默认显示，当表格列数量较多时，会导致表格横向滚动条过长，用户浏览数据不便。为提升用户体验，增强表格的灵活性和易用性，需要添加表格列隐藏功能。

### 1.3 变更目标
- 允许用户根据需求自由控制表格列的显示/隐藏
- 提升表格数据的可读性和浏览体验
- 增强系统的灵活性和用户满意度

### 1.4 变更范围
- 数据管理页面的表格组件
- 相关API和数据模型

## 2. 功能需求

### 2.1 功能概述
表格隐藏列功能允许用户在数据管理页面中，通过操作界面上的列选择器，自由控制表格中各列的显示或隐藏状态。用户的列显示偏好将被保存，以便在下次访问时保持一致。

### 2.2 功能流程图
```
用户进入数据管理页面 → 系统加载表格数据和列配置 → 显示带有列选择器的表格 → 用户点击列选择器 → 展开列选择菜单 → 用户勾选/取消勾选列 → 系统实时更新表格显示 → 保存用户列显示偏好
```

### 2.3 界面原型描述

#### 2.3.1 数据管理页面表格
- 在表格标题行右侧添加一个"列选择"按钮
- 按钮图标使用Ant Design的`ColumnsOutlined`图标
- 点击按钮后，弹出列选择菜单

#### 2.3.2 列选择菜单
- 菜单包含所有表格列的复选框
- 每个复选框对应一列，显示列名
- 默认情况下，所有列均为勾选状态
- 菜单顶部显示"全选/取消全选"选项
- 菜单支持搜索功能，方便用户快速查找列

### 2.4 交互说明

#### 2.4.1 列选择操作
- **全选/取消全选**：点击菜单顶部的"全选"选项，可一键勾选或取消勾选所有列
- **单个列选择**：点击对应列的复选框，可单独控制该列的显示或隐藏
- **实时更新**：用户勾选或取消勾选列后，表格将立即更新显示

#### 2.4.2 列宽调整
- 保持原有列宽调整功能
- 隐藏列不会影响其他列的宽度调整

#### 2.4.3 数据排序与筛选
- 保持原有数据排序和筛选功能
- 隐藏列不会影响排序和筛选功能的正常使用

#### 2.4.4 列显示偏好保存
- 系统自动保存用户的列显示偏好
- 基于用户ID和表格ID进行保存
- 下次访问同一表格时，自动恢复用户上次的列显示配置

### 2.5 约束条件

#### 2.5.1 技术约束
- 基于现有Ant Design Table组件实现
- 兼容现有系统的技术栈（React、Ant Design）
- 保持与现有功能的兼容性

#### 2.5.2 业务约束
- 至少保留一列显示，不允许隐藏所有列
- 操作列（包含编辑、删除等按钮）不允许隐藏
- 创建时间列不允许隐藏

#### 2.5.3 性能约束
- 列显示/隐藏切换的响应时间不超过500ms
- 保存用户偏好的请求响应时间不超过1000ms

## 3. 非功能需求

### 3.1 可用性需求
- 列选择器的位置明显，易于发现
- 列选择操作简单直观，符合用户习惯
- 提供清晰的视觉反馈，让用户知道操作已生效

### 3.2 兼容性需求
- 兼容Chrome、Firefox、Safari、Edge等主流浏览器
- 兼容不同屏幕尺寸，在桌面端和移动端均能正常使用

### 3.3 可维护性需求
- 代码结构清晰，易于维护和扩展
- 提供完整的注释和文档

## 4. 系统架构与数据模型

### 4.1 API需求

#### 4.1.1 新增API
- **保存列显示偏好**
  - 接口路径：`/api/v1/user-preferences/table-columns`
  - 请求方法：POST
  - 请求参数：
    ```json
    {
      "table_id": "string",
      "visible_columns": ["column_name1", "column_name2"]
    }
    ```
  - 响应参数：
    ```json
    {
      "code": 200,
      "message": "保存成功",
      "data": {
        "id": "string",
        "table_id": "string",
        "user_id": "string",
        "visible_columns": ["column_name1", "column_name2"],
        "updated_at": "timestamp"
      }
    }
    ```

- **获取列显示偏好**
  - 接口路径：`/api/v1/user-preferences/table-columns/{table_id}`
  - 请求方法：GET
  - 响应参数：
    ```json
    {
      "code": 200,
      "message": "获取成功",
      "data": {
        "id": "string",
        "table_id": "string",
        "user_id": "string",
        "visible_columns": ["column_name1", "column_name2"],
        "updated_at": "timestamp"
      }
    }
    ```

### 4.2 数据模型

#### 4.2.1 新增数据模型
- **用户表格列偏好表** (user_table_column_preferences)
  - id: 主键
  - user_id: 用户ID
  - table_id: 表格ID
  - visible_columns: 可见列列表（JSON格式）
  - created_at: 创建时间
  - updated_at: 更新时间

## 5. 界面设计

### 5.1 设计原则
- 简洁明了：列选择器的设计应简洁直观，不干扰用户的主要操作
- 一致性：保持与现有系统UI风格的一致性
- 易用性：操作流程简单，用户无需学习即可使用

### 5.2 界面原型

#### 5.2.1 数据管理页面
- 在表格右上角添加"列选择"按钮，图标为`ColumnsOutlined`
- 表格列标题保持原有样式
- 当某列被隐藏时，该列从表格中移除，其他列自动调整宽度

#### 5.2.2 列选择菜单
- 弹出式菜单，包含所有表格列的复选框
- 菜单位置：点击"列选择"按钮后，在按钮下方弹出
- 菜单样式：使用Ant Design的Dropdown和Menu组件实现
- 菜单包含搜索框，可用于快速查找列
- 菜单顶部包含"全选/取消全选"选项

## 6. 实施计划

### 6.1 开发阶段
1. **需求分析与设计**：1天
2. **前端开发**：3天
   - 修改DataManagement.jsx文件，添加列选择器功能
   - 实现列显示/隐藏的逻辑
   - 实现用户偏好的本地存储和API调用
3. **后端开发**：2天
   - 新增用户表格列偏好表
   - 实现保存和获取列偏好的API
4. **测试**：2天
   - 功能测试
   - 兼容性测试
   - 性能测试

### 6.2 上线计划
- 计划上线日期：XXXX-XX-XX
- 上线方式：灰度发布，先向管理员开放，再逐步向所有用户开放

## 7. 影响范围

### 7.1 功能影响
- 数据管理页面的表格组件功能增强
- 新增用户偏好设置功能

### 7.2 数据影响
- 新增用户表格列偏好表，用于存储用户的列显示偏好
- 不影响现有数据的结构和内容

### 7.3 接口影响
- 新增2个API接口
- 不影响现有API的使用

## 8. 优先级建议

### 8.1 优先级
中高优先级

### 8.2 优先级理由
- 该功能直接影响用户的日常操作体验
- 当表格列数量较多时，用户体验问题尤为突出
- 实现难度适中，开发周期较短
- 能显著提升系统的易用性和用户满意度

## 9. 风险评估

### 9.1 技术风险
- **风险**：用户偏好数据的存储和同步问题
  **应对策略**：使用可靠的数据库存储用户偏好，确保API的稳定性和可靠性

- **风险**：与现有功能的兼容性问题
  **应对策略**：在开发过程中进行充分的测试，确保新功能与现有功能兼容

### 9.2 业务风险
- **风险**：用户误操作导致重要列被隐藏
  **应对策略**：设置关键列（如操作列、创建时间列）不可隐藏，提供"全选"功能方便用户恢复默认显示

## 10. 验收标准

### 10.1 功能验收
- 用户可以通过列选择器控制表格列的显示/隐藏
- 列显示/隐藏的切换响应迅速
- 用户的列显示偏好能够被正确保存和恢复
- 关键列（操作列、创建时间列）不可隐藏
- 至少保留一列显示

### 10.2 性能验收
- 列显示/隐藏切换的响应时间不超过500ms
- 保存用户偏好的请求响应时间不超过1000ms
- 表格加载时间不受明显影响

### 10.3 兼容性验收
- 在Chrome、Firefox、Safari、Edge等主流浏览器上正常工作
- 在不同屏幕尺寸上正常显示和操作

## 11. 附录

### 11.1 术语表
- **表格列隐藏**：指用户可以控制表格中某些列不显示在界面上
- **列选择器**：用于控制表格列显示/隐藏的界面组件
- **用户偏好**：指用户在系统中设置的个性化配置，系统会保存并在下次使用时恢复

### 11.2 参考文档
- Ant Design Table组件文档：https://ant.design/components/table/
- React官方文档：https://react.dev/

### 11.3 变更历史
| 版本 | 变更内容 | 变更日期 | 变更人 |
|------|----------|----------|--------|
| 1.0  | 初始版本 | XXXX-XX-XX | 产品经理 |
